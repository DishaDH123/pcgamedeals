---
title: "For Project"
author: "Kristy Phipps - 85842052"
date: "15/02/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(httr)
library(jsonlite)
library(rjson)
library(dplyr)
library(tidyverse)
```



```{r}

get_active_stores <- function() {
    
    stores <- GET("https://www.cheapshark.com/api/1.0/stores")
   
        if (status_code(stores) != 200) {
            stop(paste("There was an error with the API. The reponse status is:", status_code(g)))
            }
     
    s <- content(stores, "parsed")       
    
    df <- s %>% 
          bind_rows %>% 
          filter(isActive == 1) %>%
          select(storeName, storeID) %>%
          distinct() %>%
          mutate(storeID = as.numeric(storeID))
    
    df
    
}

y <- get_active_stores()
y
```


```{r}
```


```{r}
response <- function(){
cat("Please select a Store Number from below options \n")
  
  for (i in 1:nrow(y))
    {
    cat(y$storeName[i],":", y$storeID[i],"\n")
    }
  
  val <- readline("Enter value here: ")
  val <- as.integer(val)
  cat("Select what you want from the below options:\n 1. Game within a budget\n2.Savings and current deal rating\n3.Games above a certain rating")
  opt <- readline("Enter your choice")
  opt <- as.integer(opt)
  if(opt==1){
      bud <- readline("Enter your budget: ")
      bud <- as.integer(bud)
      data <- get_game_deals_df(val,bud)
  }
  else if(opt==2){
      
  }
  else if(opt==3){
      rat <- readline("Enter the maximum percentage of rating required: ")
      rat <- as.integer(rat)
      ratings <- get_game_reviews_df(val,rat)
      
  }
  else {
      cat("You did not enter a valid input\n")
      break
  }
}
```

```{r}
response()
```

```{r}

response()

```

```{r}
get_game_deals_df <- function(storeID, price_limit) {
    
    url <- paste0("https://www.cheapshark.com/api/1.0/deals?storeID=", storeID, "&upperPrice=", price_limit)
    
    g <- GET(url)
        if (status_code(g) != 200) {
            stop(paste("There was an error with the API. The reponse status is:", status_code(g)))
            }
            
    deals <- content(g, "parsed")
    
    df <- deals %>% 
            bind_rows%>%
            select(title, storeID, normalPrice, salePrice, savings, dealRating)%>%
            mutate(normalPrice = as.numeric(normalPrice), 
                   salePrice = as.numeric(salePrice), 
                   savings = as.numeric(savings), 
                   dealRating = as.numeric(dealRating), 
                   storeID = as.numeric(storeID))
    
    df
    
}

#get_game_deals_df(3,20)
```
```{r}
get_game_reviews_df <- function(storeID, rating) {
    
    url <- paste0("https://www.cheapshark.com/api/1.0/deals?storeID=", storeID, "&metacritic=", rating)
    
    g <- GET(url)
        if (status_code(g) != 200) {
            stop(paste("There was an error with the API. The reponse status is:", status_code(g)))
            }
            
    deals <- content(g, "parsed")
    
    df <- deals %>% 
            bind_rows%>%
            select(title, metacriticScore)%>%
            mutate(metacriticScore = as.numeric(metacriticScore))
    
    return(df)
    
}

```







```{r}
is_active <- function (x) {
    
    if (x %in% y$storeID){
        print("ok")
    }
    else{
        print("Nope!")
    }
}
is_active(4)


```